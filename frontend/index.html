<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Golf Coach - Prototype</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        form { margin-bottom: 2em; padding: 1em; border: 1px solid #ccc; }
        label { display: block; margin-bottom: 0.5em; font-weight: bold; }
        input { margin-bottom: 1em; }
        pre { background-color: #f4f4f4; padding: 1em; border: 1px solid #ddd; white-space: pre-wrap; word-wrap: break-word; }
        #status { color: blue; }
        #error { color: red; }
    </style>
</head>
<body>

    <h1>AI Golf Coach Prototype</h1>

    <!-- The Form for Uploading Videos -->
    <form id="swingForm">
        <div>
            <label for="video_dtl">1. Select Down-the-Line (DTL) Video:</label>
            <input type="file" id="video_dtl" name="video_file_dtl" accept="video/*" required>
        </div>
        <div>
            <label for="video_fo">2. Select Face-On (FO) Video:</label>
            <input type="file" id="video_fo" name="video_file_fo" accept="video/*" required>
        </div>
        <button type="submit">Analyze Swing</button>
    </form>

    <!-- Section for Displaying Status and Results -->
    <div id="resultsArea">
        <h2>Analysis Status</h2>
        <p id="status">Ready to analyze. Please upload both video files.</p>
        <pre id="resultsOutput" style="display:none;"></pre>
        <pre id="errorOutput" style="display:none;"></pre>
    </div>

    <script>
        // Get references to our HTML elements
        const form = document.getElementById('swingForm');
        const statusElement = document.getElementById('status');
        const resultsOutput = document.getElementById('resultsOutput');
        const errorOutput = document.getElementById('errorOutput');

        // Listen for the form's 'submit' event
        form.addEventListener('submit', async (event) => {
            // Prevent the default browser action of reloading the page
            event.preventDefault();

            // --- Prepare for the API call ---
            statusElement.textContent = "Uploading and processing... This may take a minute or more. Please wait.";
            resultsOutput.style.display = 'none';
            errorOutput.style.display = 'none';

            // Get the files from the input fields
            const dtlInput = document.getElementById('video_dtl');
            const foInput = document.getElementById('video_fo');

            // Create a FormData object to package the files
            const formData = new FormData();
            formData.append('video_file_dtl', dtlInput.files[0]);
            formData.append('video_file_fo', foInput.files[0]);

            // Define the API endpoint URL (make sure the port matches your Uvicorn server)
            const apiUrl = 'http://127.0.0.1:8000/api/swings';

            try {
                // --- Make the API call using fetch() ---
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    body: formData,
                    // NOTE: Do NOT set the 'Content-Type' header when using FormData.
                    // The browser will automatically set it to 'multipart/form-data' with the correct boundary.
                });

                const data = await response.json();

                if (!response.ok) {
                    // Handle HTTP errors (e.g., 400, 422, 500)
                    throw new Error(data.detail || `HTTP error! Status: ${response.status}`);
                }
                
                // --- Display the successful results ---
                statusElement.textContent = "Analysis complete!";
                resultsOutput.textContent = JSON.stringify(data, null, 2); // Pretty-print the JSON
                resultsOutput.style.display = 'block';

            } catch (error) {
                // --- Display any errors ---
                statusElement.textContent = "An error occurred during analysis.";
                errorOutput.textContent = `Error: ${error.message}`;
                errorOutput.style.display = 'block';
                console.error('There was a problem with the fetch operation:', error);
            }
        });
    </script>

</body>
</html>